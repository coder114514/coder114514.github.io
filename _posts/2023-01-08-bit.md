---
title: 树状数组的正确性的证明
layout: posts
tags: OI notes
---

[出处](https://codeforces.com/blog/entry/77089)

假设树状数组是$bit[N]$，$bit[i]$ 表示$i-LSB(i)+1$到$i$这个区间的和

## 询问

根据定义，$bit[i]$ 已经包含 $i-LSB(i)+1$ 到 $i$ 这个区间了，所以在$i>0$的时候不断 $ret\leftarrow ret+bit[i], i\leftarrow i-LSB(i)$ 就可以求所要的前缀和了

而对于$i>0$显然有$i-LSB(i)<i$，于是这个过程一定可以终止

## 更新
比如修改$a[p]$，显然 $bit[p]$ 需要更新

#### 证1：$bit[p]$真包含于$bit[i_0]$，其中$i_0=p+LSB(p)$

设$p=s \times 2^{k+1} + 2^k$，则$LSB(p)=2^k$，$i_0=(s+1) \times 2^{k+1}$

不难发现 $LSB(i_0) \ge 2^{k+1}$

$i_0-LSB(i_0)+1 \le i_0-2^{k+1}+1 = s \times 2^{k+1} + 1 = p-LSB(p)+1 \le p < i_0$

#### 证2：对任意满足 $p<i<p+LSB(p)$ 的 $i$，$bit[i]$不包含$bit[p]$

设$p=s \times 2^{k+1} + 2^k$，则$i=s \times 2^{k+1}+2^k+b$，其中$1 \le b < 2^k$

不难发现 $LSB(i)=LSB(b)$

从而 $i-LSB(i)+1=i-LSB(b)+1 \geq i-b+1 = p+1 > p$ 即$bit[i]$不包含$bit[p]$

所以在$i \le n$时不断 $bit[i] \leftarrow bit[i] + delta, i\leftarrow i+LSB(i)$

（文章已根据评论修改）
